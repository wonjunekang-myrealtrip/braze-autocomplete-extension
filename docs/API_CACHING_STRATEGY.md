# API í˜¸ì¶œ ë° ìºì‹± ì „ëžµ

## ðŸ“Š Google Sheets ë°ì´í„° êµ¬ì¡°

### ë°ì´í„° ë§¤í•‘
- **ì¸ë±ìŠ¤ 2**: Custom Attributes (ì†ì„±ëª…)
- **ì¸ë±ìŠ¤ 3**: Name (í•œê¸€ëª…)
- **ì¸ë±ìŠ¤ 5**: Description (ì„¤ëª…)
- **ì¸ë±ìŠ¤ 9**: ìžë™ì™„ì„± ë©”íƒ€ íƒ€ìž…
- **ì¸ë±ìŠ¤ 10**: ENUM ê°’ë“¤ (ë©”íƒ€ê°€ ENUMì¼ ê²½ìš°)

### ìžë™ì™„ì„± ë©”íƒ€ íƒ€ìž…
- `NONE`: ìžë™ì™„ì„± ì—†ìŒ
- `CITY`: ë„ì‹œ API ì—°ë™
- `COUNTRY`: êµ­ê°€ API ì—°ë™
- `ENUM`: ì •í•´ì§„ ê°’ ëª©ë¡ ì‚¬ìš©
- `PRODUCT`: ìƒí’ˆ API ì—°ë™
- `CATEGORY`: ì¹´í…Œê³ ë¦¬ API ì—°ë™
- `DATE`: ë‚ ì§œ ì„ íƒê¸°
- `NUMBER_RANGE`: ìˆ«ìž ë²”ìœ„ ìž…ë ¥

## ðŸš€ API í˜¸ì¶œ ì‹œì  ì „ëžµ

### 1. **ì¦‰ì‹œ ë¡œë“œ (Eager Loading)**
```javascript
// Extension ì„¤ì¹˜/ì—…ë°ì´íŠ¸ ì‹œ
chrome.runtime.onInstalled â†’ Google Sheets ë°ì´í„° ì¦‰ì‹œ ë¡œë“œ
```
- âœ… ìž¥ì : ì²« ì‚¬ìš© ì‹œ ë¹ ë¥¸ ì‘ë‹µ
- âŒ ë‹¨ì : ì´ˆê¸° ë¡œë”© ì‹œê°„, ë¶ˆí•„ìš”í•œ ë°ì´í„° ë¡œë“œ

### 2. **ì§€ì—° ë¡œë“œ (Lazy Loading)** â­ ì¶”ì²œ
```javascript
// ì‚¬ìš©ìžê°€ Braze íŽ˜ì´ì§€ ë°©ë¬¸ ì‹œ
content script ì´ˆê¸°í™” â†’ backgroundì— ë°ì´í„° ìš”ì²­ â†’ ìºì‹œ í™•ì¸ â†’ í•„ìš”ì‹œ API í˜¸ì¶œ
```
- âœ… ìž¥ì : í•„ìš”í•  ë•Œë§Œ ë¡œë“œ, íš¨ìœ¨ì 
- âŒ ë‹¨ì : ì²« ì‚¬ìš© ì‹œ ì•½ê°„ì˜ ì§€ì—°

### 3. **ì˜ˆì¸¡ ë¡œë“œ (Predictive Loading)**
```javascript
// Braze ë„ë©”ì¸ ê°ì§€ ì‹œ ë¯¸ë¦¬ ë¡œë“œ
tabs.onUpdated â†’ URLì´ dashboard.braze.com í¬í•¨ â†’ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ë¯¸ë¦¬ ë¡œë“œ
```
- âœ… ìž¥ì : ì‚¬ìš© ì‹œì ì— ì´ë¯¸ ì¤€ë¹„ë¨
- âŒ ë‹¨ì : ë³µìž¡í•œ ë¡œì§

## ðŸ’¾ ìºì‹± ì „ëžµ

### 1. **ê³„ì¸µì  ìºì‹± êµ¬ì¡°**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Memory Cache (RAM)          â”‚ â† ê°€ìž¥ ë¹ ë¦„ (ì„¸ì…˜ ë™ì•ˆë§Œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Chrome Storage Local API        â”‚ â† ì˜êµ¬ ì €ìž¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Google Sheets API           â”‚ â† ì›ë³¸ ë°ì´í„°
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. **TTL (Time To Live) ì „ëžµ**

| ë°ì´í„° íƒ€ìž… | TTL | ê°±ì‹  ì£¼ê¸° | ì´ìœ  |
|------------|-----|----------|------|
| Attributes ë©”íƒ€ë°ì´í„° | 24ì‹œê°„ | ë§¤ì¼ ì˜¤ì „ 9ì‹œ | ìžì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ |
| CITY ë°ì´í„° | 7ì¼ | ì£¼ 1íšŒ | ë„ì‹œ ì •ë³´ëŠ” ê±°ì˜ ê³ ì • |
| ENUM ê°’ë“¤ | 24ì‹œê°„ | Attributesì™€ ë™ê¸°í™” | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ ê°€ëŠ¥ |
| PRODUCT ë°ì´í„° | 30ë¶„ | ì‹¤ì‹œê°„ì„± í•„ìš” | ìƒí’ˆ ì •ë³´ëŠ” ìžì£¼ ë³€ê²½ |

### 3. **ìºì‹œ ë¬´íš¨í™” ì „ëžµ**

```javascript
// ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨
popup.html â†’ "ë°ì´í„° ìƒˆë¡œê³ ì¹¨" ë²„íŠ¼ â†’ ê°•ì œ ìºì‹œ í´ë¦¬ì–´

// ìžë™ ë¬´íš¨í™”
- TTL ë§Œë£Œ ì‹œ
- Extension ì—…ë°ì´íŠ¸ ì‹œ
- ì—ëŸ¬ ë°œìƒ ì‹œ (fallback to mock)

// ë¶€ë¶„ ë¬´íš¨í™”
- íŠ¹ì • ë©”íƒ€ íƒ€ìž…ë³„ ê°œë³„ ìºì‹œ ê´€ë¦¬
```

### 4. **ìºì‹œ í¬ê¸° ê´€ë¦¬**

```javascript
// Chrome Storage ì œí•œ: 5MB (local), 100KB (sync)
// ì „ëžµ: 
1. ì••ì¶• ì €ìž¥ (JSON.stringify)
2. ì˜¤ëž˜ëœ ë°ì´í„° ìžë™ ì‚­ì œ
3. ì‚¬ìš© ë¹ˆë„ ê¸°ë°˜ ìš°ì„ ìˆœìœ„
```

## ðŸ”„ ë™ê¸°í™” ì „ëžµ

### ë°±ê·¸ë¼ìš´ë“œ ë™ê¸°í™”
```javascript
// ì•ŒëžŒ ê¸°ë°˜ ë™ê¸°í™”
chrome.alarms.create('syncData', { periodInMinutes: 360 }); // 6ì‹œê°„ë§ˆë‹¤

// ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ê¸°í™”
- ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ ì‹œ
- Extension ì‹œìž‘ ì‹œ
- ì‚¬ìš©ìž ìš”ì²­ ì‹œ
```

### ì¦ë¶„ ì—…ë°ì´íŠ¸
```javascript
// ì „ì²´ ë°ì´í„° ëŒ€ì‹  ë³€ê²½ëœ ë¶€ë¶„ë§Œ ì—…ë°ì´íŠ¸
1. ë²„ì „/íƒ€ìž„ìŠ¤íƒ¬í”„ ì²´í¬
2. ë³€ê²½ëœ í–‰ë§Œ ê°€ì ¸ì˜¤ê¸° (í–¥í›„ êµ¬í˜„)
3. ë¨¸ì§€ ì—…ë°ì´íŠ¸
```

## ðŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. **ê²€ìƒ‰ ìµœì í™”**
```javascript
// ì¸ë±ì‹±
- attribute ì´ë¦„ìœ¼ë¡œ Map ìƒì„±
- ìžë™ì™„ì„± íƒ€ìž…ë³„ ê·¸ë£¹í™”

// ë””ë°”ìš´ì‹±
- ìž…ë ¥ í›„ 100ms ëŒ€ê¸°
- ì—°ì† ìž…ë ¥ ì‹œ ì´ì „ ìš”ì²­ ì·¨ì†Œ
```

### 2. **ë©”ëª¨ë¦¬ ê´€ë¦¬**
```javascript
// WeakMap ì‚¬ìš© (ê°€ëŠ¥í•œ ê²½ìš°)
// ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë°ì´í„° ìžë™ ì •ë¦¬
// í° ë°ì´í„°ëŠ” ì²­í¬ ë‹¨ìœ„ë¡œ ë¡œë“œ
```

## ðŸŽ¯ êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1 (í˜„ìž¬)
- [x] Google Sheets ê¸°ë³¸ ì—°ë™
- [x] ê¸°ë³¸ ìºì‹± êµ¬ì¡°
- [x] Mock ë°ì´í„° í´ë°±

### Phase 2 (ë‹¤ìŒ)
- [ ] CITY API ì—°ë™
- [ ] ENUM ê°’ ì²˜ë¦¬
- [ ] ìºì‹œ TTL ê´€ë¦¬

### Phase 3 (í–¥í›„)
- [ ] PRODUCT API ì—°ë™
- [ ] ì¦ë¶„ ì—…ë°ì´íŠ¸
- [ ] ì••ì¶• ì €ìž¥
- [ ] ì˜¤í”„ë¼ì¸ ëª¨ë“œ

## ðŸ”Œ API ì—”ë“œí¬ì¸íŠ¸ (ì˜ˆì •)

```javascript
// CITY ë°ì´í„°
GET /api/cities?q={query}&limit=10

// COUNTRY ë°ì´í„°  
GET /api/countries?q={query}&limit=10

// PRODUCT ë°ì´í„°
GET /api/products?q={query}&category={category}&limit=20

// CATEGORY ë°ì´í„°
GET /api/categories?parent={parentId}
```

## ðŸ“ ì‚¬ìš© ì˜ˆì‹œ

```javascript
// Content Scriptì—ì„œ ìžë™ì™„ì„± ìš”ì²­
const attribute = 'CITY_NM';
const metadata = await getAttributeMetadata(attribute);

if (metadata.autocompleteType === 'CITY') {
  // ë„ì‹œ ìžë™ì™„ì„± API í˜¸ì¶œ
  const cities = await fetchCityData(inputValue);
  showAutocomplete(cities);
} else if (metadata.autocompleteType === 'ENUM') {
  // ENUM ê°’ í•„í„°ë§
  const filtered = metadata.enumValues.filter(v => 
    v.toLowerCase().includes(inputValue.toLowerCase())
  );
  showAutocomplete(filtered);
}
```
